<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>body { user-select: none; } .custom-scroll::-webkit-scrollbar { width: 4px; background: #374151; } .custom-scroll::-webkit-scrollbar-thumb { background: #eab308; border-radius: 4px; }</style>
</head>
<body class="bg-gray-900 text-white pb-24">

    <!-- Header -->
    <header class="p-4 bg-gray-800 shadow-md flex items-center sticky top-0 z-50 border-b border-gray-700">
        <a href="/admin-categories?mode=select&type=official" class="mr-4 text-gray-400 active:scale-90"><i class="fa-solid fa-arrow-left text-xl"></i></a>
        <div>
            <h1 class="font-bold text-lg text-yellow-500">Manage Tournament</h1>
            <p class="text-[10px] text-gray-400" id="tour_title">Loading...</p>
        </div>
    </header>

    <div class="p-4 max-w-lg mx-auto">
        
        <!-- Tournament Info Card -->
        <div class="bg-gray-800 p-5 rounded-xl border border-gray-700 shadow-lg mb-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-20 h-20 bg-yellow-500/10 rounded-full -mr-10 -mt-10 blur-xl"></div>
            <h2 class="text-xl font-bold text-white mb-1" id="tour_name_display">...</h2>
            <p class="text-xs text-gray-400 font-mono bg-gray-900 px-2 py-1 rounded inline-block border border-gray-700">ID: <span id="tour_id_display">...</span></p>
        </div>

        <!-- Tools Section -->
        <h3 class="text-gray-500 font-bold mb-3 uppercase text-xs tracking-wider border-l-2 border-yellow-500 pl-2">Quick Actions</h3>
        
        <div class="space-y-3">
            
            <!-- Row 1: Groups & Schedule -->
            <div class="grid grid-cols-2 gap-3">
                <button onclick="goToPage('groups')" class="bg-blue-600/20 border border-blue-600/50 hover:bg-blue-600 hover:text-white text-blue-400 py-4 rounded-xl font-bold shadow-lg transition flex flex-col items-center gap-1 active:scale-95">
                    <i class="fa-solid fa-users-rectangle text-2xl mb-1"></i>
                    <span class="text-xs uppercase">Groups</span>
                </button>
                <button onclick="goToPage('schedule')" class="bg-purple-600/20 border border-purple-600/50 hover:bg-purple-600 hover:text-white text-purple-400 py-4 rounded-xl font-bold shadow-lg transition flex flex-col items-center gap-1 active:scale-95">
                    <i class="fa-solid fa-calendar-days text-2xl mb-1"></i>
                    <span class="text-xs uppercase">Schedule</span>
                </button>
            </div>

            <!-- List Actions -->
            <button onclick="goToPage('schedule')" class="w-full bg-gray-800 p-4 rounded-xl border border-gray-700 flex items-center justify-between active:scale-95 transition hover:border-yellow-500">
                <div class="flex items-center gap-3">
                    <div class="bg-indigo-500/20 p-2 rounded-lg text-indigo-400"><i class="fa-solid fa-shuffle"></i></div>
                    <span class="text-sm font-bold">Manage Rounds</span>
                </div>
                <i class="fa-solid fa-chevron-right text-gray-600 text-xs"></i>
            </button>

            <button onclick="alert('Feature coming soon!')" class="w-full bg-gray-800 p-4 rounded-xl border border-gray-700 flex items-center justify-between active:scale-95 transition hover:border-red-500">
                <div class="flex items-center gap-3">
                    <div class="bg-red-500/20 p-2 rounded-lg text-red-400"><i class="fa-solid fa-user-xmark"></i></div>
                    <span class="text-sm font-bold">Eliminate Teams</span>
                </div>
                <i class="fa-solid fa-chevron-right text-gray-600 text-xs"></i>
            </button>

            <button onclick="goToPage('points')" class="w-full bg-gray-800 p-4 rounded-xl border border-gray-700 flex items-center justify-between active:scale-95 transition hover:border-green-500">
                <div class="flex items-center gap-3">
                    <div class="bg-green-500/20 p-2 rounded-lg text-green-400"><i class="fa-solid fa-chart-simple"></i></div>
                    <span class="text-sm font-bold">Update Results</span>
                </div>
                <i class="fa-solid fa-chevron-right text-gray-600 text-xs"></i>
            </button>

        </div>

        <!-- Registered Teams Preview (With Bot Button) -->
        <div class="flex justify-between items-end mt-6 mb-3">
            <h3 class="text-gray-500 font-bold uppercase text-xs tracking-wider border-l-2 border-blue-500 pl-2">Registered Teams (<span id="team_count">0</span>)</h3>
            
            <!-- âœ… BOT BUTTON FOR TESTING -->
            <button onclick="addBotTeams()" class="bg-gray-700 text-gray-300 px-2 py-1 rounded text-[10px] font-bold border border-gray-600 hover:bg-gray-600 hover:text-white transition active:scale-95">
                <i class="fa-solid fa-robot"></i> +10 Bots
            </button>
        </div>

        <div class="bg-gray-800 p-4 rounded-xl border border-gray-700 min-h-[100px]">
            <input type="text" placeholder="Quick Search..." class="w-full bg-gray-900 p-3 rounded-lg border border-gray-600 outline-none text-sm mb-3 focus:border-blue-500 text-white">
            <div id="team_list_preview" class="text-xs text-gray-400 space-y-1 font-mono">
                Loading teams...
            </div>
        </div>

    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const tourId = params.get('tour_id');
        const tourTitle = params.get('title');

        if(tourTitle) {
            document.getElementById('tour_title').innerText = decodeURIComponent(tourTitle);
            document.getElementById('tour_name_display').innerText = decodeURIComponent(tourTitle);
        }
        document.getElementById('tour_id_display').innerText = tourId;

        // Navigation Logic
        function goToPage(page) {
            if(!tourId) return alert("Tournament ID missing");

            if (page === 'schedule') {
                window.location.href = `/admin-stages?tour_id=${tourId}`;
            } 
            else if (page === 'groups') {
                window.location.href = `/admin-groups?tour_id=${tourId}`;
            }
            else if (page === 'points') {
                window.location.href = `/admin-points?tour_id=${tourId}`;
            }
        }

        async function loadTeamCount() {
            try {
                const res = await fetch('/api/official', { 
                    method: 'POST', 
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ type: 'get_official_standings', tournament_id: tourId }) 
                });
                const data = await res.json();
                document.getElementById('team_count').innerText = data.length;
                
                if(data.length > 0) {
                    document.getElementById('team_list_preview').innerHTML = data.slice(0, 5).map(t => `<p>â€¢ ${t.team_name}</p>`).join('') + (data.length > 5 ? `<p class="text-xs italic mt-2 text-blue-400">+ ${data.length-5} more...</p>` : '');
                } else {
                    document.getElementById('team_list_preview').innerHTML = '<p class="opacity-50">No teams registered yet.</p>';
                }
            } catch(e) {}
        }

        // ðŸ¤– BOT ADD LOGIC
        async function addBotTeams() {
            if(!confirm("Add 10 Fake Teams for testing?")) return;
            
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = "..."; btn.disabled = true;

            try {
                const res = await fetch('/api/official', { 
                    method: 'POST', 
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify({ type: 'add_test_teams', tournament_id: tourId, count: 10 }) 
                });
                const d = await res.json();
                if(d.success) { 
                    loadTeamCount(); 
                } else { alert("Error"); }
            } catch(e) { alert("Network Error"); }
            
            btn.innerHTML = originalText; btn.disabled = false;
        }

        loadTeamCount();
    </script>
</body>
</html>
