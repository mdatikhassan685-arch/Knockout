<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>body { font-family: 'Segoe UI', sans-serif; user-select: none; }</style>
</head>
<body class="bg-gray-100 min-h-screen pb-10">

    <!-- Header (Blue Background) -->
    <header class="bg-blue-800 p-4 text-white flex items-center shadow-lg sticky top-0 z-50">
        <a href="/admin-official" class="mr-4 hover:bg-blue-700 p-2 rounded-full transition"><i class="fa-solid fa-arrow-left text-xl"></i></a>
        <h1 class="text-xl font-bold">Manage Tournament</h1>
    </header>

    <div class="p-4 max-w-lg mx-auto">
        
        <!-- Tournament Name Card -->
        <div class="bg-white p-5 rounded-xl shadow-md mb-6 border-l-4 border-blue-600">
            <h2 class="text-2xl font-bold text-gray-800" id="tour_title">Loading Name...</h2>
            <p class="text-sm text-gray-500 mt-1">ID: <span id="tour_id_display">...</span></p>
        </div>

        <!-- Tournament Tools -->
        <h3 class="text-gray-600 font-bold mb-3 uppercase text-xs tracking-wider">Tournament Tools</h3>
        
        <div class="bg-white p-4 rounded-xl shadow-md space-y-3">
            
            <!-- Row 1: Groups & Schedule -->
            <div class="grid grid-cols-2 gap-3">
                <button onclick="goToPage('groups')" class="bg-blue-500 hover:bg-blue-600 text-white py-4 rounded-lg font-bold shadow transition flex flex-col items-center gap-1">
                    <i class="fa-solid fa-users-rectangle text-xl"></i>
                    <span>Groups</span>
                </button>
                <button onclick="goToPage('schedule')" class="bg-purple-500 hover:bg-purple-600 text-white py-4 rounded-lg font-bold shadow transition flex flex-col items-center gap-1">
                    <i class="fa-solid fa-calendar-days text-xl"></i>
                    <span>Schedule</span>
                </button>
            </div>

            <!-- Row 2: Stages/Rounds -->
            <button onclick="goToPage('schedule')" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-bold shadow transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-shuffle"></i> Manage Rounds & Qualifiers
            </button>

            <!-- Row 3: Eliminate -->
            <button onclick="alert('Feature coming soon!')" class="w-full bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-bold shadow transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-user-xmark"></i> Eliminate Teams Manually
            </button>

            <!-- Row 4: Results -->
            <button onclick="goToPage('points')" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-3 rounded-lg font-bold shadow transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-chart-simple"></i> Update Match Results
            </button>

            <!-- Row 5: Standings -->
            <button onclick="alert('Use Update Match Results to auto-update standings')" class="w-full bg-teal-500 hover:bg-teal-600 text-white py-3 rounded-lg font-bold shadow transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-list-ol"></i> Update Overall Standings
            </button>

            <!-- Row 6: Final -->
            <button onclick="alert('Feature coming soon!')" class="w-full bg-orange-500 hover:bg-orange-600 text-white py-3 rounded-lg font-bold shadow transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-star"></i> Update Final Standings
            </button>

            <!-- Row 7: Prizes -->
            <button onclick="alert('Feature coming soon!')" class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded-lg font-bold shadow transition flex items-center justify-center gap-2">
                <i class="fa-solid fa-trophy"></i> Distribute Prizes
            </button>
        </div>

        <!-- Registered Teams Section -->
        <h3 class="text-gray-600 font-bold mt-6 mb-3 uppercase text-xs tracking-wider">Registered Teams (<span id="team_count">0</span>)</h3>
        <div class="bg-white p-4 rounded-xl shadow-md min-h-[100px]">
            <input type="text" placeholder="Search team..." class="w-full bg-gray-100 p-3 rounded-lg border border-gray-300 outline-none text-sm mb-3 focus:border-blue-500">
            <div id="team_list_preview" class="text-sm text-gray-500 space-y-1">
                Loading teams...
            </div>
        </div>

    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const tourId = params.get('tour_id');
        const tourTitle = params.get('title'); // Passed from previous page to avoid extra fetch

        if(tourTitle) document.getElementById('tour_title').innerText = decodeURIComponent(tourTitle);
        document.getElementById('tour_id_display').innerText = tourId;

        // Navigation Logic
        function goToPage(page) {
            if(!tourId) return alert("Tournament ID missing");

            if (page === 'schedule') {
                // Schedule & Rounds -> admin-stages.html
                window.location.href = `/admin-stages?tour_id=${tourId}`;
            } 
            else if (page === 'groups') {
                // Groups -> admin-groups.html (Requires a stage ID, default to first stage or select stage page)
                // Since groups are stage-specific, we direct them to stages first OR need logic to fetch stage
                window.location.href = `/admin-stages?tour_id=${tourId}&msg=Select_Stage_For_Groups`;
            }
            else if (page === 'points') {
                // Update Results -> admin-points.html
                // Points are also stage specific
                window.location.href = `/admin-stages?tour_id=${tourId}&msg=Select_Stage_For_Points`;
            }
        }

        // Load Total Registered Teams count for preview
        async function loadTeamCount() {
            try {
                // We need a lightweight API to just get count. Reusing get_official_standings for now.
                const res = await fetch('/api/official', { 
                    method: 'POST', 
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({ type: 'get_official_standings', tournament_id: tourId }) 
                });
                const data = await res.json();
                document.getElementById('team_count').innerText = data.length;
                
                if(data.length > 0) {
                    document.getElementById('team_list_preview').innerHTML = data.slice(0, 5).map(t => `<p>â€¢ ${t.team_name}</p>`).join('') + (data.length > 5 ? `<p class="text-xs italic mt-2 text-blue-500">+ ${data.length-5} more...</p>` : '');
                } else {
                    document.getElementById('team_list_preview').innerText = "No teams registered yet.";
                }
            } catch(e) {}
        }

        loadTeamCount();
    </script>
</body>
  </html>
